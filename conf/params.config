/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    wf-assembly-snps Nextflow params config file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

// This code is adapted from: https://github.com/bactopia/bactopia

params {
    /*
    ============================================
        Input Options
    ============================================
    */

    input                             = null
    ref                               = null
    outdir                            = null

    /*
    ============================================
        SNP workflow (parsnp)
    ============================================
    */

    snp_package                       = "parsnp"

    /*
    ============================================
        Default parameters
    ============================================
    */

    // Minimum input filesize required
    min_input_filesize                = "45k"

    // Default parameters
    recombination                     = "none"

    // Excel spreadsheet parameters
    excel_sheet_name                  = "Sheet1"
    create_excel_outputs              = false

    /*
    ============================================
        Parsnp-specific parameters
    ============================================
    */
    
    // Parsnp parameters
    curated_input                     = false    // Use curated input mode
    tree_method                       = "fasttree"  // Tree method: "fasttree" or "raxml"
    max_partition_size                = 15000    // Maximum partition size for Parsnp
    
    // File size validation parameters
    min_parsnp_output_filesize        = "1k"     // Minimum Parsnp output file size
    min_gingr_to_fasta_filesize       = "1k"     // Minimum Gingr to FASTA file size
    min_tree_filesize                 = "100"    // Minimum tree file size

    /*
    ============================================
        Scalable workflow parameters
    ============================================
    */

    // Enable scalable mode (clustering-based approach)
    scalable_mode                     = false
    
    // Workflow mode: 'cluster', 'place', or 'global'
    workflow_mode                     = "cluster"
    
    // Resume optimization parameters
    enable_resume_optimization        = true    // Enable checksum-based resume optimization
    work_cache_dir                    = "${params.outdir}/work_cache"  // Directory for cached work files
    
    // Clustering parameters
    mash_threshold                    = 0.03
    max_cluster_size                  = 100
    merge_singletons                  = false  // Merge all singleton clusters into one large cluster
    
    // Mash sketch parameters for large-scale analysis
    mash_sketch_size                  = 10000   // Sketch size (default: 1000, increase for large datasets)
    mash_kmer_size                    = 21      // K-mer size (default: 21)
    mash_min_copies                   = 1       // Minimum copies of each k-mer (default: 1)
    
    // Gubbins optimization parameters
    run_gubbins                       = true
    gubbins_iterations                = 3
    gubbins_use_hybrid                = true
    gubbins_first_tree_builder        = "rapidnj"
    gubbins_tree_builder              = "iqtree"
    gubbins_min_snps                  = 2
    
    // IQ-TREE parameters
    iqtree_model                      = "GTR+ASC"
    iqtree_asc_model                  = "GTR+ASC"
    iqtree_fconst                     = null
    
    // Integration parameters
    integrate_results                 = true    // Integrate core SNPs and graft trees across clusters
    
    // UShER parameters for incremental updates
    build_usher_mat                   = false
    existing_mat                      = null
    
    /*
    ============================================
        Recombination-aware workflow parameters
    ============================================
    */
    
    // Enable recombination-aware mode
    recombination_aware_mode          = false
    
    // Alignment method for per-cluster analysis
    alignment_method                  = "snippy"  // Options: "snippy", "parsnp"
    
    // Backbone tree construction
    backbone_method                   = "parsnp"  // Options: "parsnp", "fasttree"
    backbone_fasttree_opts            = "-nt -gtr"
    backbone_container                = null      // Override container if needed
    
    // UShER-based phylogenetic placement parameters
    use_usher_placement               = true     // Use UShER instead of gotree for tree grafting
    usher_retain_branch_lengths       = true     // Retain input branch lengths in backbone
    usher_optimize_final_tree         = true     // Optimize final tree after placement
    usher_container                   = null     // Override UShER container if needed
    
    // Legacy tree grafting parameters (deprecated in favor of UShER)
    rescale_grafted_branches          = false    // Rescale branch lengths after grafting

    /*
    ============================================
        Boilerplate options
    ============================================
    */

    tracedir                          = "${params.outdir}/pipeline_info"
    process_log_dir                   = "${params.tracedir}/process_logs"
    qc_filecheck_log_dir              = "${params.tracedir}/qc_file_checks"

    email                             = null
    hook_url                          = null
    email_on_fail                     = null

    help                              = false
    version                           = false
    validate_params                   = true
    plaintext_email                   = false
    monochrome_logs                   = false
    publish_dir_mode                  = 'copy'
    show_hidden_params                = false
    validationShowHiddenParams        = false
    validationSchemaIgnoreParams      = 'genomes,igenomes_base'

    /*
    ============================================
        Configuration options
    ============================================
    */

    custom_config_version             = 'master'
    custom_config_base                = "https://raw.githubusercontent.com/nf-core/configs/${params.custom_config_version}"
    config_profile_description        = null
    config_profile_contact            = null
    config_profile_url                = null
    config_profile_name               = null

    /*
    ============================================
        Max resource options
    ============================================
    */

    // Defaults only, expecting to be overwritten
    max_memory                        = '128.GB'
    max_cpus                          = 16
    max_time                          = '240.h'

    /*
    ============================================
        Nextflow profile parameters
    ============================================
    */

    profile_cache_dir                 = "${projectDir}/assets/.cache"
    schema_ignore_params              = "min_tree_filesize,min_distance_matrix_filesize,min_snp_distance_filesize,min_snp_positions_filesize,max_partition_size,tree_method,curated_input,min_parsnp_output_filesize,workflows,available_workflows,validationSchemaIgnoreParams,recombination,snp_package,ref,validation-schema-ignore-params,genomes,igenomes_base,sge_process_high_cpu,sge_process_high_mem,sge_process_time,sge_options,sge_queue_size,sge_penv,existing_mat,build_usher_mat,iqtree_model,gubbins_min_snps,gubbins_tree_builder,gubbins_first_tree_builder,gubbins_use_hybrid,gubbins_iterations,run_gubbins,max_cluster_size,mash_threshold,workflow_mode,scalable_mode,merge_singletons,integrate_results"
}